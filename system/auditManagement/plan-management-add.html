<!DOCTYPE html>
<html class="x-admin-sm" xmlns:th="http://www.w3.org/1999/html">

<head>
    <link rel="stylesheet" href="../../css/font.css">
    <link rel="stylesheet" href="../../css/xadmin.css">
    <link rel="stylesheet" href="../../layui/css/layui.css">
    <link rel="stylesheet" href="../../css/JCheck.css">
    <script type="text/javascript" src="../../js/jqery/jquery-3.4.1.js"></script>
    <script type="text/javascript" src="../../layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="../../js/xadmin.js"></script>
    <script type="text/javascript" src="../../js/jwt.js"></script>
    <script type="text/javascript" src="../../js/cookie.js"></script>
    <script src="../../js/JCheck.js"></script>
</head>

<body>
<div class="x-body">
    <form class="layui-form" lay-filter="planAddForm">
        <input name="impUserId" type="hidden" id="impUserId"/>
        <div class="layui-form-item">
            <label class="layui-form-label">
                <span class="x-red">*</span>审计年度:
            </label>
            <div class="layui-input-block">
                <input name="auditYear" id="start" class="layui-input layui-disabled" autocomplete="off"
                       placeholder="请输入审计年度">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                <span class="x-red">*</span>项目名称:
            </label>
            <div class="layui-input-block">
                <input name="projectName" type="text" lay-verify="required|projectName" placeholder="请输入项目名称"
                       autocomplete="off" class="layui-input" value="">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                <span class="x-red">*</span>项目类型:
            </label>
            <div class="layui-input-block">
                <select id="projectTypeSelect" lay-verify="required" name="projectType">
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                <span class="x-red">*</span>实施机构:
                <input name="implementingAgencyId" lay-verify="required" type="hidden" id="implementingAgencyId">
            </label>
            <div class="layui-input-block">
                <div class="layui-input-inline" style="width: calc(50% - 10px)">
                    <input class="layui-input" lay-verify="required" id="implementingAgencyName"
                           name="implementingAgencyName" disabled/>
                </div>
                <div style="width:50%; float:left">
                    <select id="impAdminSelect" lay-verify="required" name="impAdminId">
                    </select>
                </div>
            </div>

        </div>

        <div class="layui-form-item muqi layui-hide">
            <label class="layui-form-label">
                <span class="x-red">*</span>审计对象:
            </label>
            <div class="layui-input-block">

                <div class="layui-input-inline" style="width: calc(50% - 10px)">
                    <select id="auditObjectIdSelect_new" lay-verify="required" lay-filter="one_cate_new">
                    </select>
                </div>
                <div style="width:50%; float:left">
                    <select id="auditAdminSelect_new" lay-verify="required" name="auditObjectId" lay-filter="two_cate_new">
                    </select>
                </div>
            </div>
        </div>

        <div class="layui-form-item muqi layui-hide">
            <label class="layui-form-label">
                <span></span>
            </label>
            <div class="layui-input-block">
                <div class="layui-input-inline" style="width: calc(50% - 10px)">
                    <select id="auditUserSelect_new" lay-verify="required" name="auditAdminId">
                    </select>
                </div>
            </div>
        </div>

        <div class="layui-form-item muqi_other layui-hide">
            <label class="layui-form-label">
                <span class="x-red">*</span>审计对象:
            </label>
            <div class="layui-input-block">

                <div class="layui-input-inline" style="width: calc(50% - 10px)">
                    <select id="auditObjectIdSelect" lay-verify="required" name="auditObjectId" lay-filter="one_cate">
                    </select>
                </div>
                <div style="width:50%; float:left">
                    <select id="auditAdminSelect" lay-verify="required" name="auditAdminId">
                    </select>
                </div>
            </div>
        </div>

        <div class="layui-form-item mr16" style="width:calc(50% - 16px);float: left; clear:none">
            <label class="layui-form-label">
                <span class="x-red">*</span>审计性质:
            </label>
            <div class="layui-input-block">
                <select id="auditNatureIdSelect" lay-verify="required" name="auditNatureId">
                </select>
            </div>
        </div>
        <div class="layui-form-item ml16" style="width:calc(50% - 16px);float: left; clear:none">
            <label class="layui-form-label">
                <span class="x-red">*</span>问题类型:
            </label>
            <div class="layui-input-block">
                <select id="questionTypeSelect" class="layui-input" name="questionType" lay-verify="required">

                </select>
            </div>
        </div>
        <div class="layui-form-item mr16" style="width:calc(50% - 16px);float: left; clear:none">
            <label class="layui-form-label">
                <span class="x-red">*</span>严重程度:
            </label>
            <div class="layui-input-block">
                <select id="problemSeverityIdSelect" lay-verify="required" name="problemSeverityId">
                </select>
            </div>
        </div>
        <div class="layui-form-item ml16" style="width:calc(50% - 16px);float: left; clear:none">
            <label class="layui-form-label">
                <span class="x-red">*</span>整改情况:
            </label>
            <div class="layui-input-block">
                <select id="rectifySituationIdSelect" lay-verify="required" name="rectifySituationId">
                </select>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                <span class="x-red">*</span>问题词条:
            </label>
            <div class="layui-input-block">
                <input name="questionEntryId" type="text" lay-verify="required" placeholder="请输入问题词条" autocomplete="off"
                       class="layui-input" value="">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                <span class="x-red">*</span>问题定性:
            </label>
            <div class="layui-input-block">
                <input name="problemCharacterization" lay-verify="required" type="text" placeholder="请输入问题定性"
                       autocomplete="off"
                       class="layui-input" value="">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                <span class="x-red">*</span>问题描述:
            </label>
            <div class="layui-input-block">
                <textarea name="problemDescription" lay-verify="required" placeholder="请输入问题描述"
                          class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                可能影响:
            </label>
            <div class="layui-input-block">
                <!-- <input name="mayAffect" type="text" placeholder="请输入可能影响" autocomplete="off" class="layui-input"
                    value=""> -->

                <textarea name="mayAffect" placeholder="请输入可能影响" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                整改建议:
            </label>
            <div class="layui-input-block">
                <textarea name="rectificationSuggestions" placeholder="请输入整改建议" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item layui-form-text">
            <label class="layui-form-label">
                审计建议:
            </label>
            <div class="layui-input-block">
                <textarea name="auditSuggestions" placeholder="审计建议" class="layui-textarea"></textarea>
            </div>
        </div>
        <div class="layui-form-item mr16">
            <label class="layui-form-label">
                审计分类:
            </label>
            <input type="hidden" id="auditClassificationIdSelect" name="auditClassificationId">
            <div class="layui-input-block">
                <div class="layui-input-inline">
                    <select name="auditClassificationIdSelect1" id="auditClassificationIdSelect1"
                            lay-filter="auditClassificationIdSelect1"
                            style="float: left">
                    </select>
                </div>
                <div class="layui-input-inline">
                    <select name="auditClassificationIdSelect2" id="auditClassificationIdSelect2"
                            lay-filter="auditClassificationIdSelect2"
                            style="float: left">
                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item mr16">
            <label class="layui-form-label">风险评估:</label>
            <input type="hidden" name="riskAssessmentId" id="riskAssessmentIdSelect">
            <div class="layui-input-block">
                <div class="layui-input-inline">
                    <select name="riskAssessmentIdSelect1" id="riskAssessmentIdSelect1"
                            lay-filter="riskAssessmentIdSelect1"
                            style="float: left">
                    </select>
                </div>
                <div class="layui-input-inline">
                    <select name="riskAssessmentIdSelect2" id="riskAssessmentIdSelect2"
                            lay-filter="riskAssessmentIdSelect2"
                            style="float: left">
                    </select>
                </div>
            </div>
            <div class="layui-input-block">
                <div class="layui-input-inline">
                    <select name="riskAssessmentIdSelect3" id="riskAssessmentIdSelect3"
                            lay-filter="riskAssessmentIdSelect3" style="float: left">
                    </select>
                </div>
                <div class="layui-input-inline">
                    <select name="riskAssessmentIdSelect4" id="riskAssessmentIdSelect4"
                            lay-filter="riskAssessmentIdSelect4" lay-verify="required" style="float: left">
                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                机构层级:
            </label>
            <div class="layui-input-block">
                <input name="agencyLevel" type="text" placeholder="请输入机构层级" autocomplete="off" class="layui-input"
                       value="">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                进点时间:
            </label>
            <div class="layui-input-block">
                <input name="enterTime" type="text" placeholder="请输入进点时间" autocomplete="off" class="layui-input"
                       value="">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                组织形式:
            </label>
            <div class="layui-input-block">
                <input name="orgType" type="text" placeholder="请输入组织形式" autocomplete="off" class="layui-input"
                       value="">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                主要负责人责任类型:
            </label>
            <div class="layui-input-block">
                <input name="managerDutyType" type="text" placeholder="请输入主要负责人责任类型" autocomplete="off"
                       class="layui-input"
                       value="">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                风险类别:
            </label>
            <div class="layui-input-block">
                <input name="riskType" type="text" placeholder="请输入风险类别" autocomplete="off" class="layui-input"
                       value="">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                所属职能:
            </label>
            <div class="layui-input-block">
                <input name="functionType" type="text" placeholder="请输入所属职能" autocomplete="off" class="layui-input"
                       value="">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">
                审计依据:
            </label>
            <div class="layui-input-block">
                <input name="auditBasis" type="text" placeholder="请输入审计依据" autocomplete="off" class="layui-input"
                       value="">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">
                审计经验:
            </label>
            <div class="layui-input-block">
                <input name="auditingExperience" type="text" placeholder="请输入审计经验" autocomplete="off"
                       class="layui-input"
                       value="">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">
                附件上传:
            </label>
            <div class="layui-input-inline">
                <input type="hidden" name="fileUri">
                <span class="layui-btn file-btn" id="upload" name="file-btn" style="float: left;"><i
                        class="layui-icon">&#xe681;</i>上传</span>
                <span name="uploadName" style="float: left;margin: 8px 0 0 16px;"></span>
            </div>
        </div>


        <div style="text-align: center;">
            <div class="layui-input-inline" style="margin-left: -50px;">
                <label for="L_repass" class="layui-form-label">
                </label>
                <button class="layui-btn" lay-submit lay-filter="addPlanCheckList">
                    <i class="layui-icon">&#xe605;</i>添加
                </button>
            </div>
            <div class="layui-input-inline">
                <label for="L_repass" class="layui-form-label">
                </label>
                <a class="layui-btn" onclick="off()">
                    <i class="layui-icon">&#x1007;</i>取消
                </a>
            </div>
        </div>


    </form>
</div>
<script>

    //审计对象处理
    let text = userInfo.deptName;
    if (text.toString().indexOf("乌鲁木齐") > -1) {
        $(".muqi").removeClass("layui-hide");
        $(".muqi_other").remove();
    } else {
        $(".muqi_other").removeClass("layui-hide");
        $(".muqi").remove();
    }

    function initMultiLevelEntry(defKey, level, elem, maxLevel) {
        layui.use(['form', 'layer'], function () {
            var form = layui.form;
            let nxtLevel = parseInt(level) + 1;
            if (nxtLevel > (maxLevel + 1)) {
                return;
            }
            $.ajax({
                url: "/audit-api/planManage/selectEntryByLevel",
                dataType: "json",
                type: "get",
                data: {
                    defKey: defKey,
                    level: undefined == level ? 1 : level,
                    name: undefined == $("#" + elem + 1 + " :selected").attr("name") ? '' : $("#" + elem + 1 + " :selected").attr("name"),
                    name1: undefined == $("#" + elem + 2 + " :selected").attr("name") ? '' : $("#" + elem + 2 + " :selected").attr("name"),
                    name2: undefined == $("#" + elem + 3 + " :selected").attr("name") ? '' : $("#" + elem + 3 + " :selected").attr("name"),
                    name3: undefined == $("#" + elem + 4 + " :selected").attr("name") ? '' : $("#" + elem + 4 + " :selected").attr("name"),
                },
                async: false,
                success: function (resp) {
                    if (resp && 0 == resp.code) {
                        let data = resp.data;
                        let options = [];
                        options.push('<option value="" >请选择</option>')
                        data.forEach((Obj) => {
                            let option = '<option name="' + (undefined == Obj.name ? '默认' : Obj.name) + '"  value="' + Obj.id + ' ">' + (undefined == Obj.name ? '默认' : Obj.name) + '</option>';
                            options.push(option);
                        })
                        $("#" + elem + level).empty().append(options.join(""));
                    }
                }
            });
            form.on("select(" + elem + level + ")", function (data) {
                let name = $(data.elem).find(':selected')[0].text;
                let val = $(data.elem).find(':selected').first().val();
                var tempLevel = nxtLevel;
                while (tempLevel <= maxLevel) {
                    $("#" + elem + (tempLevel++)).val('')
                }
                $("#" + elem).val(val)
                initMultiLevelEntry(defKey, nxtLevel, elem, maxLevel)
            })
            form.render("select");
        })
    }

    layui.use(['form', 'layer', 'upload'], function () {
        if (!userInfo) {
            return top.layer.msg("用户身份信息已失效", {icon: 2})
        }
        //赋值
        $("#implementingAgencyId").val(userInfo.deptId);
        $("#implementingAgencyName").val(userInfo.deptName);
        $("#createdBy").val(userInfo.userId);
        $("#impUserId").val(userInfo.userId);

        let form = layui.form
        let layer = layui.layer;
        let upload = layui.upload;

        upload.render({
            elem: '#upload',
            url: '/audit-api/file/upload',
            auto: true,//选完文件后自动上传
            data: {
                bizKey: userInfo.username
            },
            accept: 'file', //所有文件
            size: 500 * 1024, //限制文件大小，单位 KB
            done: function (res) {
                //上传成功毕回调
                if (res.code == 0) {
                    let data = res.data;
                    $("[name='uploadName']").text(data.substr(data.lastIndexOf('/') + 1));
                    $("[name='fileUri']").val(data);
                    $(".file-btn").text('重新上传');
                    console.log(res)
                } else {
                    top.layer.msg("上传失败", {icon: 1})
                }
            },
            choose: function (obj) {

            }
        });
        {
            $.ajax({
                url: "/audit-api/planManage/getUsersByRoleNameAndDept?deptId=" + userInfo.deptId + "&roleName=审计实施管理员",
                dataType: "json",
                type: "get",
                async: false,
                headers: createAuthorizationTokenHeader(),
                success: function (resp) {
                    if (resp && 0 == resp.code) {
                        let data = resp.data;
                        let options = [];
                        options.push('<option value="" >请选择实施机构审批人员</option>')
                        data.forEach((Obj) => {
                            let option = '<option value="' + Obj.userId + '">' + Obj.username + '</option>';
                            options.push(option);
                        })
                        $("#impAdminSelect").empty().append(options.join(""));
                    }
                }
            });
            $.ajax({
                url: "/audit-api/planManage/getUsersByRoleNameAndDept?deptId=" + userInfo.deptId + "&roleName=审计实施一般角色",
                dataType: "json",
                type: "get",
                async: false,
                headers: {
                    Authorization: window.sessionStorage.getItem('Authorization')
                },
                success: function (resp) {
                    if (resp && 0 == resp.code) {
                        let data = resp.data;
                        let options = [];
                        options.push('<option value="" >请选择实施机构一般用户</option>')
                        data.forEach((Obj) => {
                            let option = '<option value="' + Obj.userId + '">' + Obj.username + '</option>';
                            options.push(option);
                        })
                        $("#impUserSelect").empty().append(options.join(""));
                    }
                }
            });
        }
        $.ajax({
            url: "/audit-api/planManage/getAuditObject?deptId=" + userInfo.deptId,
            dataType: "json",
            type: "get",
            async: false,
            headers: createAuthorizationTokenHeader(),
            success: function (resp) {
                if (resp && 0 == resp.code) {
                    let data = resp.data;
                    let options = [];
                    options.push('<option value="" >请选择审计对象</option>')
                    data.forEach((Obj) => {
                        let option = '<option value="' + Obj.deptId + '">' + Obj.name + '</option>';
                        options.push(option);
                    })
                    $("#auditObjectIdSelect").empty().append(options.join(""));
                }
            }
        })
        $.ajax({
            url: "/audit-api/planManage/getAuditAndImpObject?deptId=" + userInfo.deptId,
            dataType: "json",
            type: "get",
            async: false,
            headers: createAuthorizationTokenHeader(),
            success: function (resp) {
                if (resp && 0 == resp.code) {
                    let data = resp.data;
                    let options = [];
                    options.push('<option value="" >请选择审计对象</option>')
                    data.forEach((Obj) => {
                        let option = '<option value="' + Obj.deptId + '">' + Obj.name + '</option>';
                        options.push(option);
                    })
                    $("#auditObjectIdSelect_new").empty().append(options.join(""));
                }
            }
        })
        $.ajax({
            url: "/audit-api/planManage/selectEntryByCategoryId?categoryId=3",
            dataType: "json",
            type: "get",
            async: false,
            success: function (resp) {
                if (resp && 0 == resp.code) {
                    let data = resp.data;
                    let options = [];
                    options.push('<option value="" >请选择项目类型</option>')
                    data.forEach((Obj) => {
                        let option = '<option value="' + Obj.id + '">' + Obj.name + '</option>';
                        options.push(option);
                    })
                    $("#projectTypeSelect").empty().append(options.join(""));
                }
            }
        });
        $.ajax({
            url: "/audit-api/planManage/selectEntryByCategoryId?categoryId=4",
            dataType: "json",
            type: "get",
            async: false,
            success: function (resp) {
                if (resp && 0 == resp.code) {
                    let data = resp.data;
                    let options = [];
                    options.push('<option value="" >请选择审计性质</option>')
                    data.forEach((Obj) => {
                        let option = '<option value="' + Obj.id + '">' + Obj.name + '</option>';
                        options.push(option);
                    })
                    $("#auditNatureIdSelect").empty().append(options.join(""));
                }
            }
        });
        $.ajax({
            url: "/audit-api/planManage/selectEntryByCategoryId?categoryId=8",
            dataType: "json",
            type: "get",
            async: false,
            success: function (resp) {
                if (resp && 0 == resp.code) {
                    let data = resp.data;
                    let options = [];
                    options.push('<option value="" >请选择问题词条</option>')
                    data.forEach((Obj) => {
                        let option = '<option value="' + Obj.id + '">' + Obj.name + '</option>';
                        options.push(option);
                    })
                    $("#questionEntryIdSelect").empty().append(options.join(""));
                }
            }
        });
        $.ajax({
            url: "/audit-api/planManage/selectEntryByCategoryId?categoryId=10",
            dataType: "json",
            type: "get",
            async: false,
            success: function (resp) {
                if (resp && 0 == resp.code) {
                    let data = resp.data;
                    let options = [];
                    options.push('<option value="" >请选择问题类型</option>')
                    data.forEach((Obj) => {
                        let option = '<option value="' + Obj.id + '">' + Obj.name + '</option>';
                        options.push(option);
                    })
                    $("#questionTypeSelect").empty().append(options.join(""));
                }
            }
        });
        $.ajax({
            url: "/audit-api/planManage/selectEntryByCategoryId?categoryId=5",
            dataType: "json",
            type: "get",
            async: false,
            success: function (resp) {
                if (resp && 0 == resp.code) {
                    let data = resp.data;
                    let options = [];
                    options.push('<option value="" >请选择问题严重程度</option>')
                    data.forEach((Obj) => {
                        let option = '<option value="' + Obj.id + '">' + Obj.name + '</option>';
                        options.push(option);
                    })
                    $("#problemSeverityIdSelect").empty().append(options.join(""));
                }
            }
        });
        $.ajax({
            url: "/audit-api/planManage/selectEntryByCategoryId?categoryId=6",
            dataType: "json",
            type: "get",
            async: false,
            success: function (resp) {
                if (resp && 0 == resp.code) {
                    let data = resp.data;
                    let options = [];
                    options.push('<option value="" >请选择问题整改情况</option>')
                    data.forEach((Obj) => {
                        let option = '<option value="' + Obj.id + '">' + Obj.name + '</option>';
                        options.push(option);
                    })
                    $("#rectifySituationIdSelect").empty().append(options.join(""));
                }
            }
        });

        initMultiLevelEntry('FXPG', '1', 'riskAssessmentIdSelect', 4)
        initMultiLevelEntry('SJFL', '1', 'auditClassificationIdSelect', 2)

        form.verify({
            projectName: function (value, dom) {
                if (value.length > 128) {
                    return '项目名称不能超过128个字符！'
                }
            }
        })
        form.render('select');
        //监听提交
        form.on('submit(addPlanCheckList)', function (data) {
            let formData = form.val("planAddForm");
            formData.createdUsername = userInfo.username
            formData.createdBy = userInfo.userId
            $.ajax({
                url: '/audit-api/planCheckList/saveOrEditPlan',
                type: 'POST',
                contentType: 'application/json;charset=utf-8',
                async: false,
                data: JSON.stringify(formData),
                success: function (resp) {
                    //发异步，把数据提交给php
                    if (0 == resp.code) {
                        layer.alert("增加成功", {icon: 6}, function () {
                            // 获得frame索引
                            var index = parent.layer.getFrameIndex(window.name);
                            //关闭当前frame
                            parent.layer.close(index);
                            // 可以对父窗口进行刷新
                            x_admin_father_reload();
                        });
                    } else {
                        layer.alert("操作失败 " + resp.msg, {icon: 2}, function () {

                        })
                    }

                },
                error: function (error) {
                    layer.alert(error)
                }
            })
            return false;
        });
        form.on('select(one_cate)', function (data) {
            let deptId = data['value'];
            $.ajax({
                url: "/audit-api/planManage/getUsersByRoleNameAndDept?deptId=" + deptId + "&roleName=审计对象管理员",
                dataType: "json",
                type: "get",
                async: false,
                headers: {
                    Authorization: window.sessionStorage.getItem('Authorization')
                },
                success: function (resp) {
                    if (resp && 0 == resp.code) {
                        let data = resp.data;
                        let options = [];
                        options.push('<option value="" >请选择审计对象审批人员</option>')
                        data.forEach((Obj) => {
                            let option = '<option value="' + Obj.userId + '">' + Obj.username + '</option>';
                            options.push(option);
                        })
                        $("#auditAdminSelect").empty().append(options.join(""));
                    }
                }
            });
            $.ajax({
                url: "/audit-api/planManage/getUsersByRoleNameAndDept?deptId=" + deptId + "&roleName=审计对象一般角色",
                dataType: "json",
                type: "get",
                async: false,
                headers: {
                    Authorization: window.sessionStorage.getItem('Authorization')
                },
                success: function (resp) {
                    if (resp && 0 == resp.code) {
                        let data = resp.data;
                        let options = [];
                        options.push('<option value="" >请选择审计对象一般用户</option>')
                        data.forEach((Obj) => {
                            let option = '<option value="' + Obj.userId + '">' + Obj.username + '</option>';
                            options.push(option);
                        })
                        $("#auditUserSelect").empty().append(options.join(""));
                    }
                }
            });
            form.render("select");
        });
        form.on('select(one_cate_new)', function (data) {
            let deptId = data['value'];
            $.ajax({
                url: "/audit-api/planManage/getAuditObject?deptId=" + deptId,
                dataType: "json",
                type: "get",
                async: false,
                headers: createAuthorizationTokenHeader(),
                success: function (resp) {
                    if (resp && 0 == resp.code) {
                        let data = resp.data;
                        let options = [];
                        options.push('<option value="" >请选择审计对象</option>')
                        data.forEach((Obj) => {
                            let option = '<option value="' + Obj.deptId + '">' + Obj.name + '</option>';
                            options.push(option);
                        })
                        $("#auditAdminSelect_new").empty().append(options.join(""));
                    }
                }
            })
            form.render("select");
        });
        form.on('select(two_cate_new)', function (data) {
            let deptId = data['value'];
            $.ajax({
                url: "/audit-api/planManage/getUsersByRoleNameAndDept?deptId=" + deptId + "&roleName=审计对象管理员",
                dataType: "json",
                type: "get",
                async: false,
                headers: {
                    Authorization: window.sessionStorage.getItem('Authorization')
                },
                success: function (resp) {
                    if (resp && 0 == resp.code) {
                        let data = resp.data;
                        let options = [];
                        options.push('<option value="" >请选择审计对象审批人员</option>')
                        data.forEach((Obj) => {
                            let option = '<option value="' + Obj.userId + '">' + Obj.username + '</option>';
                            options.push(option);
                        })
                        $("#auditUserSelect_new").empty().append(options.join(""));
                    }
                }
            });
            form.render("select");
        });

    });
    layui.use('laydate', function () {
        let laydate = layui.laydate;

        //执行一个laydate实例
        laydate.render({
            elem: '#start', //指定元素
            type: "year"
        });
        // //执行一个laydate实例
        // laydate.render({
        //     elem: '[name="enterTime"]', //指定元素
        // });

    });
</script>
<script>
    function off() {
        let index = parent.layer.getFrameIndex(window.name); //获取当前窗口的name
        parent.layer.close(index);		//关闭窗口
    }
</script>

</body>

</html>